<html>
<head><title>Тест</title>
<meta charset="utf-8">


<link rel="stylesheet" href="data/css/bootstrap.min.css">
<script  type="text/javascript"src="data/js/bootstrap.min.js"></script>
<script type="text/javascript" src="data/data.js"></script>
<script src='http://code.jquery.com/jquery-2.1.1.min.js'></script>
<style>
body {
  display: -ms-flexbox;
  display: -webkit-box;
  display: flex;
  -ms-flex-align: center;
  -ms-flex-pack: center;
  -webkit-box-align: center;
  align-items: center;
  -webkit-box-pack: center;
  justify-content: center;
  padding-top: 40px;
  padding-bottom: 40px;
  background-color: #f5f5f5;
}
p, span, input, td {
 font-size:24px;
}
button{
    font-size:18px;
}
#ot {
    color:blue;
}

#LabelZad {
     font-size:14px;
	 color:blue;
	 
}

</style>
</head>

<!--****************************************************************************************  -->
<body class="text-center">

<div id="LabeZad1"> 
     <span id="LabelZad"> 
	       Задание №1   
	       <input type="number" style="width:70px; font-size:14px;" step="1" min="0" placeholder="0"  id="kol1" > <br> <br>
	       Задание №2  
	       <input type="number" style="width:70px; font-size:14px;" step="1" min="0" placeholder="0"  id="kol2" >  <br> <br>
	      Задание №3  
	       <input type="number" style="width:70px; font-size:14px;" step="1" min="0" placeholder="0"  id="kol3" >  <br> <br>
	
	 </span>

    <button id="play" class="btn btn-lg btn-primary btn-block" style="margin-left:auto;margin-right:auto;width:250px;" onclick="nachat()";> Начать </button> 
</div>

<p id="name_test" style="font-weight:bold;position:absolute;top:20px;">Тест. Тема - "<span id="tema"> </span>".</p>
<div style="text-align:center;">

<div class="card">
 <!--<div class="card-body">  -->


 


 <div id="vopros1" style="display:none;">
   <p>Вопрос 1</p>
   <div class="alert alert-secondary" role="alert" ">
       <p><span id="v_1"></span> <input class="form-control" type="text" id="z_1"></p>
   </div>
 </div>

<div id="vopros2" style="display:none;">
<p>Вопрос 2</p>
<div class="alert alert-secondary" role="alert">
<p><span id="v_2"></span> <input class="form-control" type="text" id="z_2"></p>
</div>
</div>

<div id="vopros3" style="display:none;">
<p>Вопрос 3</p>
<div class="alert alert-secondary" role="alert">
<p><span id="v_3"></span> <input class="form-control" type="text" id="z_3"></p>
</div>
</div>

<div id="vopros4" style="display:none;">
<p>Вопрос 4</p>
<div class="alert alert-secondary" role="alert">
<p><span id="v_4"></span> <input class="form-control" type="text" id="z_4"></p>
</div>
</div>

<div id="vopros5" style="display:none;">
<p>Вопрос 5</p>
<div class="alert alert-secondary" role="alert" ">
<p><span id="v_5"></span> <input class="form-control" type="text" id="z_5"></p>
</div>
</div>

<div id="vopros6" style="display:none;">
<p>Вопрос 6</p>
<div class="alert alert-secondary" role="alert">
<p><span id="v_6"></span> <input class="form-control" type="text" id="z_6"></p>
</div>
</div>

<div id="vopros7" style="display:none;">
<p>Вопрос 7</p>
<div class="alert alert-secondary" role="alert">
<p><span id="v_7"></span> <input class="form-control" type="text" id="z_7"></p>
</div>
</div>

<div id="vopros8" style="display:none;">
<p>Вопрос 8</p>
<div class="alert alert-secondary" role="alert">
<p><span id="v_8"></span> <input class="form-control" type="text" id="z_8"></p>
</div>
</div>



<div id="vopros9" style="display:none;">
<p>Вопрос 9</p>
<div class="alert alert-secondary" role="alert">
<p><span id="v_9"></span> <input class="form-control" type="text" id="z_9"></p>
</div>
</div>

<!--<div id="vopros10" style="display:none;">
<p>Вопрос 10</p>
<div class="alert alert-secondary" role="alert">
<p><span id="v_10"></span> <input class="form-control" type="text" id="z_10"></p>
</div>
</div>    -->

<button id="kn_sl" class="btn btn-lg btn-primary btn-block" style="margin-left:auto;margin-right:auto;display:none;width:250px;" onclick="sled_vopr();">Следующий вопрос</button>
<button id="kn_pr" class="btn btn-lg btn-primary btn-block" style="margin-left:auto;margin-right:auto;display:none;width:250px;" onclick="proverit();">Проверить</button>
<div id="rezultat"></div>
</div>
</div>

<script>

function ActiveStart() {              //функция активности/неавтивности кнопки НАЧАТЬ в зависимости от нулей в окнах

   if ((document.getElementById('kol1').valueAsNumber == "0" ) && (document.getElementById('kol2').valueAsNumber == "0" )  &&
   (document.getElementById('kol3').valueAsNumber == "0" ))
   {
   
     document.getElementById('play').style.color="gray";
     document.getElementById('play').setAttribute("disabled","disabled"); 
  } else {
     document.getElementById('play').removeAttribute("disabled");
	 document.getElementById('play').style.color="black";
      
  };
}

kol1.onchange = ActiveStart;
kol2.onchange = ActiveStart;
kol3.onchange = ActiveStart;




document.addEventListener('DOMContentLoaded', function(){     //при загрузке страницы присвоить значения 0, иначе 0 не воспринимается
   // Ваш скрипт
   document.getElementById('kol1').value="0";
   document.getElementById('kol2').value="0";
   document.getElementById('kol3').value="0";
   document.getElementById('play').style.color="grey";
   document.getElementById('play').setAttribute("disabled","disabled"); 
   
});
//*************************************************************************************************************************************
function nachat(){
  kol_zad_vbase1=10;    
  kol_zad_vbase2=10;
  kol_zad_vbase3=10;
  inpKol1=document.getElementById('kol1').valueAsNumber;
  inpKol2=document.getElementById('kol2').valueAsNumber;
  inpKol3=document.getElementById('kol3').valueAsNumber;
  inpKol=+inpKol1+ +inpKol2+ +inpKol3;     //количество заданий из формы
  
  masvopr1=[];    // заполняем массив именами подгружаемых картинок
  for ( var i = 0; i <= kol_zad_vbase1-1; i++){
	   masvopr1[i]="<img src='data/01/01_" + (i+1) + ".jpg' class='rounded mx-auto d-block'>";
  }
	
  masvopr2=[];    // заполняем массив именами подгружаемых картинок	
  for ( var i = 0; i <=kol_zad_vbase2-1; i++){
	   masvopr2[i]="<img src='data/02/02_" + (i+1) + ".jpg' class='rounded mx-auto d-block'>";
  }

  masvopr3=[];    // заполняем массив именами подгружаемых картинок	
  for ( var i = 0; i <=kol_zad_vbase3-1; i++){
	   masvopr3[i]="<img src='data/03/03_" + (i+1) + ".jpg' class='rounded mx-auto d-block'>";
  }

//*****************************************************************************************************************************************************
  voprosi=[]     //формируем мссив с картинками и правильными ответами
  for ( var j = 0; j <= (kol_zad_vbase1-1); j++) {
     voprosi[j] = [];
     voprosi[j][0] = masvopr1[j]; 
     voprosi[j][1] = pr_otv_zadachi1[j];
  }
	
  if(peremeshat_voprosi == "да"){         //перемешиваем часть с первыми заданиями
     voprosi = peremeshat_vse_voprosi(voprosi,0,kol_zad_vbase1-1);
  }
   voprosi.splice(inpKol1);      //удаляем ненужные первые задания
 //*******************************************************************************************************************************************
  
  for ( var j = 0; j <= (kol_zad_vbase2-1); j++) {         //заполняем с колва первых зад +1, перекрывая тем самым ненужные первые задания
	 voprosi[j+inpKol1] = [];
	 voprosi[j+inpKol1][0] = masvopr2[j]; 
	 voprosi[j+inpKol1][1] = pr_otv_zadachi2[j];
  }  

  if(peremeshat_voprosi == "да"){                    //перемешиваем
     voprosi = peremeshat_vse_voprosi(voprosi,inpKol1,inpKol1+kol_zad_vbase2-1);
		 
   voprosi.splice(inpKol1+inpKol2);      //удаляем ненужные вторые задания
   
//**********************************************************************************************************************************************
	  for ( var j = 0; j <= (kol_zad_vbase3-1); j++) {         //заполняем с колва первых зад +1, перекрывая тем самым ненужные первые задания
	 voprosi[j+inpKol1+inpKol2] = [];
	 voprosi[j+inpKol1+inpKol2][0] = masvopr3[j]; 
	 voprosi[j+inpKol1+inpKol2][1] = pr_otv_zadachi3[j];
  }  

  if(peremeshat_voprosi == "да"){                    //перемешиваем
     voprosi = peremeshat_vse_voprosi(voprosi,inpKol1+inpKol2,inpKol1+inpKol2+kol_zad_vbase3-1);}
		 
   voprosi.splice(inpKol1+inpKol2+inpKol3);      //удаляем ненужные вторые задания
	 
	 
	 
	 
  }
 //***************************************************************************************************************************************************
  for ( var i = 1; i <=(inpKol); i++){
      document.getElementById('v_'+i).innerHTML = voprosi[i-1][0];
  }
 
  document.getElementById('tema').innerHTML = test;

  document.getElementById('vopros1').style.display = "block";
  document.getElementById('kn_sl').style.display = "block";
  document.getElementById('LabeZad1').style.display = "none";

if (inpKol == 1) {                                                  //если заданий всего одно, то сразу кнопку проверить
     document.getElementById('kn_sl').style.display = "none";
     document.getElementById('kn_pr').style.display = "block";
 	
  }

}

//*************************************************************************************************************************************
function sled_vopr(){       // отображение кнопок и заданий на экране
    inpKol1=document.getElementById('kol1').value;
	inpKol2=document.getElementById('kol2').value;
	inpKol3=document.getElementById('kol3').value;
	inpKol=+inpKol1+ +inpKol2+ + inpKol3;     //количество заданий из формы
	
    
	 if(document.getElementById('vopros'+(inpKol-1)).style.display == "block"){
         document.getElementById('vopros'+(inpKol-1)).style.display = "none";
         document.getElementById('vopros'+inpKol).style.display = "block";
	     document.getElementById('kn_sl').style.display = "none";
         document.getElementById('kn_pr').style.display = "block";
      }
	 for ( var i = inpKol-2; i => 1; i--){
         if(document.getElementById('vopros'+i).style.display == "block"){
                  document.getElementById('vopros'+i).style.display = "none";
                  document.getElementById('vopros'+(i+1)).style.display = "block";
          }
	 }
    
}
//*************************************************************************************************************************************



//****************************************************************************************************************
function proverit(){
    inpKol1=document.getElementById('kol1').value;
	inpKol2=document.getElementById('kol2').value;
	inpKol3=document.getElementById('kol3').value;
	inpKol=+inpKol1+ +inpKol2+ +inpKol3;     //количество заданий из формы

    otv_uch=[];          //создаем две табл с ответами и закодир ответами
    otv_uch_orig=[];

    for (var  i = 0; i <= (inpKol-1); i++){             
       otv_uch[i] = document.getElementById('z_'+(i+1)).value;
       otv_uch_orig[i] = otv_uch[i];
       otv_uch[i] = kodirov(otv_uch[i]);
     }

    ball = 0;
    document.getElementById('vopros'+inpKol).style.display = "none";    //прячем все вопросы
    document.getElementById('kn_pr').style.display = "none";
    document.getElementById('name_test').style.display = "none";

    otveti = "<table class='table'><tr class='table-active'><td>№</td><td>Вопрос </td><td>Ответ</td></tr>"; //выводим таблицу с ответами

    for (var  i = 0; i <= (inpKol-1); i++){ 
       if(otv_uch[i] == voprosi[i][1]){
           ball +=1;
           otveti += "<tr class='table-success'><td>"+(i+1)+"</td><td>"+voprosi[i][0]+"</td><td>Вы ответили верно. Ваш ответ: "+otv_uch_orig[i]+inpKol+"</td></tr>";
       }else {
           otveti += "<tr class='table-danger'><td>"+(i+1)+"</td><td>"+voprosi[i][0]+"</td><td>Вы ответили не верно. Ваш ответ: "+otv_uch_orig[i]+"</td></tr>"; 
       }
    }
 
     vsego_zadach = inpKol;
     procent_vip = ball/vsego_zadach * 100;
     procent_vip = procent_vip.toFixed();
	 document.getElementById('rezultat').innerHTML = "<p style='font-weight:bold;'>Тест. Тема - '<span id='tema2'></span>'.</p><span id='ot'>Задания выполнены верно на "+procent_vip+"%.</span><br><div class='progress'><div class='progress-bar' role='progressbar' style='width: "+procent_vip+"%' aria-valuenow='"+procent_vip+"' aria-valuemin='0' aria-valuemax='100'></div></div><br>"+otveti;
     document.getElementById('tema2').innerHTML = test;
	 
//**************************************	    ВЫГРУЗКА в EXCEL

   //  var Name = jQuery("#Namggge").val();
 //    var Phone = jQuery("#Phone").val();
   //  var Procent = 100;
     var http = new XMLHttpRequest();
     var url = "https://script.google.com/macros/s/AKfycbyQeL95AzZs8WZKD_5Zi3n7fz1djbgWxNVD8TNXRDP_3U4HYWA/exec";
     var params = "&p1="+procent_vip;
     http.open("GET", url+"?"+params, true);
     http.send(null);

 //  var params = "p1="+Name+"&p2="+Phone+"&p3="+Quession;
 //     http.onreadystatechange = function() {
     //      if((http.readyState == 4) && ((http.status = 200))) {
      //        //  alert(http.responseText);
   //         }
      //  }
}

function kodirov(stroka) { 
    var b64ch = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefg'+ 
                   'hijklmnopqrstuvwxyz0123456789+/='; 
    var b64enc = ''; 
    var ch1, ch2, ch3; 
    var en1, en2, en3, en4; 
    for (var i=0; i<stroka.length;) { 
        ch1 = stroka.charCodeAt(i++); 
        ch2 = stroka.charCodeAt(i++); 
        ch3 = stroka.charCodeAt(i++); 
        en1 = ch1 >> 2; 
        en2 = ((ch1 & 3) << 4) | (ch2 >> 4); 
        en3 = isNaN(ch2) ? 64:(((ch2 & 15) << 2) | (ch3 >> 6)); 
        en4 = isNaN(ch3) ? 64:(ch3 & 63); 
        b64enc += b64ch.charAt(en1) + b64ch.charAt(en2) + 
                      b64ch.charAt(en3) + b64ch.charAt(en4); 
    } 
    return b64enc; 
}
function peremeshat_vse_voprosi(m_vopros,k1,k2) {
    for (var i = k2 ; i > k1; i--) {
        var j = Math.floor(Math.random() * (k2 - k1)) + k1;
        var temp = m_vopros[i];
        m_vopros[i] = m_vopros[j];
        m_vopros[j] = temp;
    }
    return m_vopros;
}


</script>


</body>
</html>